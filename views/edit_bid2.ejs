<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Edit Bid</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/checkout/">
    <!-- Bootstrap core CSS -->
		<link rel="stylesheet" href="/assets/dist/css/bootstrap.min.css" >
    <!-- Custom styles for this template -->
		<link href="/css/form-validation.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <%- include('./partials/nav_bar.ejs') %>
    <div class="container">
  <div class="py-5 text-center">
    <h2>Edit Bid</h2>
  </div>

	<!--Summary on the right-->
  <div class="row">
    <div class="col-md-4 order-md-2 mb-4">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Your cart</span>
        <span class="badge badge-secondary badge-pill"></span>
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Caretaker</h6>
          </div>
          <span class="text-muted">Jennie</span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Start Date</h6>
          </div>
					<span class="text-muted"><%= convertDate(originalStartDate) %></span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">End Date</h6>
          </div>
          <span class="text-muted"><%= convertDate(originalEndDate) %></span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Cost per day</h6>
          </div>
          <span class="text-muted">$30</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total (SGD)</span>
          <strong>$20</strong>
        </li>
      </ul>
		</div>
		<!--Summary end-->
    <div class="col-md-8 order-md-1">
      <form action="/submit_edit" class="needs-validation" novalidate method="POST">
        <div class="row">
          <div class="col-md-7 mb-3">
            <h4 class="mb-3">Change Pet Transfer Method</h4>
            <p>Current method: <%= transferConvert(trans.method_of_pet_transfer) %></p>
            <div class="float-left">
              <select class="custom-select d-block" name="transferMethod" required> 
                <option value = "cPickup">Caretaker pickup</option>
                <option value = "oDeliver">Dropoff at caretaker</option>
                <option value = "office">Dropoff at Pet Care office.</option>
              </select>
            </div>
            <div class="invalid-feedback">
              Please select a valid pet transfer method.
            </div>
          </div>
        </div>
        <hr class="mb-4">
        <h4 class="mb-3">Change Dates</h4>
        <div class="row justify-content-between">
					<div class="col-md-5 mb-3 float-left">
						<input type="text" class="form-control float-right" name="dates">
						<input type="hidden" id="startDate" name="startDate" value="">
						<input type="hidden" id="endDate" name="endDate" value="">
					</div>
        </div>
        <hr class="mb-4">

        <div class="row">
					<div class="col-md-4 mb-3">
						<button class="btn btn-primary btn-lg btn-block" type="submit" style="float:right">Confirm Changes</button>
					</div>
					<div class="col-md-4 mb-3">
						<button class="btn btn-danger btn-lg btn-block" type="submit" style="float:right">Cancel Bid</button>
					</div>
				</div>
				<!--Pass back original hire data.-->
				<input type="hidden" name="ct_email" value=<%= trans.ct_email %>>
				<input type="hidden" name="ori_start_date" value=<%= moment(trans.start_date).format() %>>
				<input type="hidden" name="ori_end_date" value=<%= moment(trans.end_date).format() %>>
				<input type="hidden" name="pet_name" value=<%= trans.pet_name %>>
      </form>
    </div>
  </div>

  <footer class="my-5 pt-5 text-muted text-center text-small">
  </footer>
</div>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/plugins/bootstrap/js/form-validation.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
	<script>
		var today = new Date("<%= today %>");
		var latestDate = new Date("<%= latestDate %>");
		var isPartTimer = "<%= isPartTimer %>" == "true"
		var blockedDates = <%- JSON.stringify(blockedDates) %>;
		blockedDates = new Set(blockedDates);
		var availableDates = <%- JSON.stringify(availableDates) %>;
		availableDates = new Set(availableDates);
		var originalStartDate = new Date("<%= originalStartDate %>");
		var originalEndDate = new Date("<%= originalEndDate %>");

		$('input[name="dates"]').daterangepicker({
			minDate: today,
			maxDate: latestDate,
			startDate: originalStartDate,
			endDate : originalEndDate,
			locale: {
    		format: 'DD/MM/YYYY'
  		},
			isInvalidDate : (aDate) => {
				const date = aDate.format('YYYY-MM-DD');
				if (isPartTimer) {
					return !(availableDates.has(date) && !blockedDates.has(date));
				} else {
					return blockedDates.has(date);
				}
			}
		});
		$('input[name="dates"]').on('apply.daterangepicker', function(ev, picker) {
			console.log(picker.startDate.format('YYYY-MM-DD'));
  		console.log(picker.endDate.format('YYYY-MM-DD'));
			document.getElementById("startDate").value = picker.startDate;
			document.getElementById("endDate").value = picker.endDate;
		});


	</script>
</body>
</html>
