<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/profile_styles.css">
  <script src="/plugins/jquery/jquery.min.js"></script>
  <script src="/plugins/moment/moment.min.js"></script>
  <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
  <script src="/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
  <script src="/plugins/daterangepicker/daterangepicker.js"></script>
  <script src="/dist/js/adminlte.min.js"></script>
  <link rel="stylesheet" href="/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
  <link rel="stylesheet" href="/plugins/daterangepicker/daterangepicker.css">
  <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
  <script>
    $(function () {
      // Setup - add a text input to each footer cell
      $('#example1 tfoot th').each(function () {
        var title = $(this).text();
        $(this).html('<input type="text" placeholder="Search ' + title + '" style="width: 100%;"/>');
      });

      // DataTable
      var table = $('#example1').DataTable({
        "responsive": true,
        "autoWidth": false,
        initComplete: function () {
          // Apply the search
          this.api().columns().every(function () {
            var that = this;

            $('input', this.footer()).on('keyup change clear', function () {
              if (that.search() !== this.value) {
                that
                  .search(this.value)
                  .draw();
              }
            });
          });

          var r = $('#example1 tfoot tr');
          r.find('th').each(function () {
            $(this).css('padding', 8);
          });
          $('#example1 thead').append(r);
        }
      });
      let urlArray = window.location.href.split('/')
      if (urlArray[urlArray.length - 1] == 'search') {
        $('#reservation').daterangepicker({}, function (start, end, label) {
          console.log("A new date selection was made: " + start.format('MM-DD-YYYY') + ' to ' + end.format('MM-DD-YYYY'));
          window.location.href = '/search/' + start.format('MM-DD-YYYY') + '/' + end.format('MM-DD-YYYY')
        })
      } else {
        $('#reservation').daterangepicker({ startDate: new Date(urlArray[urlArray.length - 2]), endDate: new Date(urlArray[urlArray.length - 1]) }, function (start, end, label) {
          console.log("A new date selection was made: " + start.format('MM-DD-YYYY') + ' to ' + end.format('MM-DD-YYYY'));
          window.location.href = '/search/' + start.format('MM-DD-YYYY') + '/' + end.format('MM-DD-YYYY')
        })
      }

    });
  </script>
</head>

<body>
  <%- include('./partials/nav_bar.ejs') %>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Search Care Takers</h3>
    </div>
    <!-- /.card-header -->
    <div class="card-body">
      <div class="form-group">
        <label>Availability Date range:</label>
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text">
              <i class="far fa-calendar-alt"></i>
            </span>
          </div>
          <input type="text" class="form-control float-right" id="reservation">
        </div>
        <!-- /.input group -->
      </div>
      <table id="example1" class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Email</th>
            <th>Name</th>
            <th>Location</th>
            <th>Rating</th>
            <th>Daily Price</th>
            <th>Pet Type</th>
          </tr>
        </thead>
        <tbody>
          <% for(var i = 0; i < careTakers.length; i++) { %>
          <tr>
            <td><%= careTakers[i].email %></td>
            <td><%= careTakers[i].name %>
            </td>
            <td><%= careTakers[i].location %></td>
            <td><%= Number(careTakers[i].rating).toFixed(2) %></td>
            <td><%= careTakers[i].price %></td>
            <td><%= careTakers[i].pet_type %></td>
          </tr>
          <% } %>
        </tbody>
        <tfoot>
          <tr>
            <th>Email</th>
            <th>Name</th>
            <th>Location</th>
            <th>Rating</th>
            <th>Daily Price</th>
            <th>Pet Type</th>
          </tr>
        </tfoot>
      </table>
    </div>
    <!-- /.card-body -->
  </div>
  <!-- /.card -->
</body>

</html>